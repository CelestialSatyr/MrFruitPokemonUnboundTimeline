:root{
  --muted: #86d8d4;
  --bg: #f1fdfb;
  --text: #020a09;
  --primary: #3bddca;
  --secondary: #7fc7e9;
  --accent: #6398e4;
  --container-max: 90vw;
}

/* Reset / base */
* { box-sizing: border-box; }
html,body { height: 100%; }
body{
  margin:0;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  line-height: 1.35;
}

/* Header */
header{
  background: radial-gradient(circle at center, var(--primary), var(--secondary));
  color: var(--text);
  padding: 25px 12px;
}
.header-inner{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  max-width: var(--container-max);
  margin:0 auto;
  width: 100%;
}
.header-left h1 { margin:0; font-size:1.1rem; }
.header-left .sub { margin:4px 0 0; font-size:0.85rem; opacity:0.95; }
.btn{ border:0; background:transparent; color:var(--text); cursor:pointer; font-weight:600; padding:6px 8px; border-radius:6px; }
.btn.small{ font-size:0.86rem; padding:4px 6px; color:var(--text); }

/* Rules panel (dropdown under header) */
.rules-panel{
  max-width: var(--container-max);
  margin:8px auto 0;
  padding:12px;
  background: var(--bg);
  border-radius:10px;
  color:var(--text);
  box-shadow:0 10px 30px rgba(12,16,34,0.12);
  position:relative;
  z-index:20;
}
.rules-header{ display:flex; justify-content:space-between; align-items:center; color:var(--text); margin-bottom:8px; }
.rules-list{ margin:6px 0 8px 20px; }
.rules-note{ font-size:0.9rem; color:var(--text); }

/* Main container (responsive - no forcing min-width) */
.container{
  width: min(94vw, var(--container-max));
  max-width: var(--container-max);
  margin:14px auto;
  padding:0 16px 60px;
}

/* Run details banner (responsive) */
.run-details{
  display:flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  width: 100%;
  box-sizing: border-box;
  background: radial-gradient(circle at center, var(--primary), var(--secondary));
  border-radius:12px;
  padding:12px;
  box-shadow:0 6px 18px rgba(127,199,233,0.25);
  margin-bottom:14px;
  position:relative;
  z-index:3;
  flex-wrap: wrap; /* allow wrapping on small screens */
}

/* left and right columns */
.run-left {
  display:flex;
  align-items:center;
  gap:12px;
  flex: 1 1 60%;   /* grow and take available room */
  min-width: 0;    /* critical to allow shrinking */
  justify-content: flex-start;
}

.run-right {
  display:flex;
  align-items:center;
  gap:12px;
  flex: 0 0 auto;  /* do not take a large percentage â€” use content width */
  min-width: 0;     /* allow internal elements to shrink */
  justify-content: flex-end; /* push internal items to the far right of the run-right block */
}

/* person-info wrapper so text can shrink/wrap as desired */
.person-info {
  display:flex;
  flex-direction: column;
  gap: 4px;
  min-width: 0; /* critical */
  overflow: hidden;
}

.person-info.reverse {
  align-items: flex-end;
  text-align: right;
}

/* Mobile: stack and make run-right full width and left-aligned */
@media (max-width: 900px) {
  .run-details {
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
  }

  .run-left {
    flex: 1 1 100%;
    justify-content: flex-start;
  }

  .run-right {
    flex: 1 1 100%;
    justify-content: flex-start; /* left-align on mobile */
  }

  .person-info.reverse {
    align-items: flex-start;
    text-align: left;
  }
}

/* player/rival sprite sizing - responsive and constrained */
.person-sprite{
  width: clamp(48px, 14vw, 120px); /* responsive size */
  height: auto;
  display:block;
  object-fit: contain;
  padding:4px;
  flex: 0 0 auto;
  border-radius: 6px;
}

/* Names and subs - truncate if necessary */
.person-name{
  font-weight:700;
  font-size: clamp(1rem, 2.6vw, 1.6rem);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}
.person-sub, .rival-sub{
  font-size: clamp(0.85rem, 1.6vw, 1rem);
  color: #052423;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

/* Reverse layout on right column text */
.person-info.reverse { align-items: flex-end; text-align: right; }
@media (max-width:900px) {
  .person-info.reverse { align-items: flex-start; text-align: left; }
}

/* Controls */
.controls{
  display:flex;
  gap:12px;
  align-items:center;
  flex-wrap:wrap;
  margin:14px 0 22px;
}
.controls label{ font-size:0.9rem; color:var(--text); }
.controls select, .controls input{
  margin-left:8px;
  padding:6px 8px;
  border-radius:8px;
  color: var(--text);
  border:1px solid #d6d6df;
  background: white;
  font-size:0.95rem;
}
#jump-episode{
  margin-left:8px;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid #2f364f;
  background:var(--accent);
  color:var(--text);
  cursor:pointer;
}

/* Timeline base & line (behind everything) */
.timeline{
  position:relative;
  padding:30px 0;
  margin:0 auto;
  width:100%;
  min-height:200px;
}
.timeline::before{
  content:"";
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  top:0;
  bottom:0;
  width:4px;
  background:var(--secondary);
  border-radius:4px;
  box-shadow:0 0 0 2px rgba(127,199,233,0.06);
  z-index:1; /* behind banners and events */
}

/* Episode banner (single definition, used for collapsible header) */
.episode-banner{
  clear:both;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  width:100%;
  text-align:center;
  margin:22px 0;
  padding:10px 14px;
  background: radial-gradient(circle at center, var(--primary), var(--secondary));
  color:var(--text);
  border-radius:10px;
  font-weight:600;
  box-shadow:0 6px 18px rgba(127,199,233,0.12);
  position:relative;
  z-index:4; /* above timeline line but below header visuals */
}
.episode-banner .permalink {
  background:transparent;border:0;color:rgba(0,0,0,0.85);cursor:pointer;font-size:0.95rem;padding:6px;border-radius:6px;
}

/* Event card common */
.event {
  width: 46%;
  padding: 12px 14px;
  position: relative;
  margin-bottom: 22px;
  border-radius: 10px;
  background: var(--muted);
  box-shadow: 0 6px 18px rgba(16,18,36,0.06);
  display: block;
  box-sizing: border-box;
  z-index: 3; /* above timeline line */
}

/* left/right floats for side placement */
.event.left {
  float: left;
  clear: both;
  transform: translateX(20px);
  margin-right: 4%;
}
.event.right {
  float: right;
  clear: both;
  transform: translateX(-20px);
  margin-left: 4%;
}

/* Event header */
.event-header {
  display: block;
  width: 100%;
  box-sizing: border-box;
  padding: 8px 12px;
  margin-bottom: 8px;
  background: var(--secondary);
  border-radius: 8px;
  text-align: center;
  font-weight: 700;
  font-size: 1.05rem;
  color: var(--text);
  line-height: 1.2;
  position: relative;
  z-index: 5;
}

/* Body (visual + text) */
.event-body {
  display: flex;
  flex-direction: row;
  gap: 12px;
  align-items: flex-start;
  width: 100%;
  box-sizing: border-box;
  position: relative;
  z-index: 3;
}

/* Visual column (sprite / badge / evolution) */
.event-body .visual {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Text column */
.event-body .item-body {
  flex: 1 1 auto;
  min-width: 0; /* prevents overflow */
}

/* Mobile layout adjustments */
@media (max-width:900px){
  .container{ width: 94vw; }
  .event{ width:100%; float:none; transform:none; margin-left:0; margin-right:0; padding:10px; }
  .timeline::before{ left:20px; transform:none; width:3px; }
}

/* =========================
   Collapsible episodes
   ========================= */

.episode-section { margin-bottom: 12px; position: relative; z-index: 4; }

.episode-banner {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  cursor: pointer;
  user-select: none;
  padding: 10px 14px;
  border-radius: 10px;
  font-weight: 600;
  position: relative;
  box-shadow:0 6px 18px rgba(16,18,36,0.06);
}

/* Chevron rotation */
.episode-banner .chev { display:inline-block; transition: transform 220ms ease; transform-origin: center; }
.episode-banner[aria-expanded="true"] .chev { transform: rotate(180deg); }

/* Episode contents */
.episode-contents {
  overflow: hidden;
  transition: max-height 300ms ease, opacity 250ms ease;
  opacity: 1;
  max-height: 2000px;
  margin-top: 12px;
}
.episode-contents.collapsed { max-height: 0 !important; opacity: 0; margin-top: 0; }

.episode-banner .controls { position: absolute; right: 12px; display:flex; gap:8px; align-items:center; }
.episode-banner:focus { outline: 3px solid rgba(74,99,214,0.18); outline-offset: 2px; }
@media (max-width:900px) { .episode-banner { justify-content: flex-start; padding-left: 18px; } }

/* Sprites & badges */
.sprite {
  width: 96px;
  height: 96px;
  object-fit: contain;
  flex-shrink: 0;
  padding: 6px;
  border-radius:6px;
}
.badge-icon {
  width: 72px;
  height: 72px;
  object-fit: contain;
  flex-shrink: 0;
  border-radius:8px;
  padding:6px;
}

/* text blocks */
.item-body { flex:1; min-width:0; }
.primary-action{ margin:0 0 6px; font-weight:700; font-size:1rem; }
.species-nick{ margin:0 0 6px; color:#222; font-size:0.98rem; }
.obtained-line{ font-size:0.9rem; color:var(--text); margin-bottom:6px; }
.item-notes{ font-size:0.9rem; color:#444 }

/* evolution row */
.evolution-row{ display:flex; align-items:center; gap:10px; margin-bottom:8px; }
.evolution-row .sprite{ width:72px; height:72px; }
.evolve-arrow{ font-size:1.25rem; color:var(--text); margin:0 6px; }

/* message panel */
.message{ margin-top:18px; padding:12px 14px; background:#fff7e6; border:1px solid #ffe4b5; border-radius:8px; color:#7a5a00; position:relative; z-index:3; }

/* Back to top */
.back-to-top{
  position:fixed;
  right:22px;
  bottom:22px;
  width:46px;
  height:46px;
  border-radius:10px;
  background:var(--accent);
  color:var(--text);
  border:0;
  cursor:pointer;
  font-size:20px;
  display:none;
  align-items:center;
  justify-content:center;
  box-shadow:0 10px 30px rgba(16,18,36,0.16);
  z-index:40;
}

.small-control{
  margin-left:8px;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid #2f364f;
  background:var(--accent);
  color:var(--text);
  cursor:pointer;
}

/* footer */
.footer{
  clear: both;
  width: 100%;
  text-align:center;
  margin:36px 0 80px;
  color:var(--text);
  font-size:1rem;
}

/* ---------------- Run-ended / fainted visuals ---------------- */

.run-end-banner {
  clear: both;
  display: block;
  width: 100%;
  text-align: center;
  margin: 22px 0;
  padding: 12px 16px;
  background: linear-gradient(90deg, #b00000, #ff6b6b);
  color: white;
  border-radius: 10px;
  font-weight: 800;
  box-shadow: 0 8px 20px rgba(176, 0, 0, 0.12);
  position: relative;
  z-index: 6;
}

.run-ended-top {
  margin-top: 8px;
  padding: 6px 10px;
  border-radius: 8px;
  background: linear-gradient(90deg,#fff5f5,#fff0f0);
  color: #8a0000;
  font-weight:700;
  border:1px solid #ffd6d6;
}

/* Fainted event visuals */
.event.fainted .sprite,
.event.fainted .badge-icon {
  filter: grayscale(100%) contrast(85%);
  opacity: 0.72;
}
.event.fainted .event-header {
  background: linear-gradient(180deg,#fff0f0,#ffe6e6);
  color: #7a0011;
  border: 1px solid #ffcccc;
}
.event.fainted { box-shadow: 0 8px 24px rgba(160, 16, 16, 0.04); }

/* Ensure banners and events are above the line */
.episode-banner, .run-end-banner { position: relative; z-index: 5; }
.event { position: relative; z-index: 3; }

/* mobile tidy fainted appearance */
@media (max-width: 900px) {
  .event.fainted .sprite { opacity:0.78; }
}

/* small helpers */
.hidden { display:none !important; }